---
title: "Edge effects on species establishement, growth and survival in an experimental plant invasion"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document:
    toc: yes
  word_document: null
---

```{r set options, include=F, echo=F}

knitr::opts_chunk$set(fig.width = 7, fig.height = 3.5)
knitr::opts_chunk$set(dpi = 600)
knitr::opts_chunk$set(echo = F)
knitr::opts_chunk$set(warning = F)
knitr::opts_chunk$set(message = F)
knitr::opts_chunk$set(fig.asp = .5)
# knitr::opts_chunk$set(eval = F)

# options(na.action = "na.fail")# global model setting for using multimodel inference 'dredge' function

```

```{r load packages}
# library(lme4); library(car); library(sciplot); library(lmerTest); 
# library(MuMIn)
library(plyr); library(dplyr); library(tidyr); library(readr)
library(ggplot2)
library(knitr)

fill_manual <- scale_fill_manual(values = c("grey80", "grey60", "grey40"))
color_manual <- scale_color_manual(values = c("grey40", "grey80"))
```

```{r load data}
seedling_data <- read_csv("data/seedling_growth_survival_data.csv")
germination_data <- read_csv("data/germination_data.csv")
forest_data <- read_csv("data/forest_trees.csv")
light_data <- read_csv("data/light2005_data.csv")
litter_data <- read_csv("data/litter.csv")
soil_moisture_data <- read_csv("data/soil_moisture2005_data.csv")
```

```{r check data}

sites <- data_frame(unique(seedling_data$site_code), unique(seedling_data$site_name))
names(sites) <- c("site_code","site_name")

library(stringr)
germination_data <- rename(germination_data, site_code = site)
# sort(unique(germination_data$site_code))
germination_data$site_code <- germination_data$site_code %>%
  str_sub(., 1,3) %>% 
  str_replace_all(c("Cic"="CH","Dub"="DB","Duc"="DU","Dug"="DG","For"="FR","Gri"="GR","Hdq"="HQ","Lil"="LD","Par"="PR","SR4"="SR","Yel"="TC"))

forest_data <- rename(forest_data, site_code = site)
# unique(forest_data$site_code)
forest_data$site_code <- forest_data$site_code %>% 
  str_replace_all(c("DUCK"="DU","DUB"="DB","DUG"="DG", "SR45"="SR"))

light_data <- rename(light_data, site_code = site)
# unique(light_data$site_code)
light_data$site_code <- light_data$site_code %>% 
  str_replace_all(c("DUCK"="DU","DUB"="DB","DUG"="DG", "SR45"="SR"))

litter_data <- rename(litter_data, site_code = site)
# unique(litter_data$site_code)
litter_data$site_code <- litter_data$site_code %>% 
  str_replace_all(c("DUCK"="DU","DUB"="DB","DUG"="DG", "SR45"="SR"))

soil_moisture_data <- rename(soil_moisture_data, site_code = site)
# unique(soil_moisture_data$site_code)
soil_moisture_data$site_code <- soil_moisture_data$site_code %>% 
  str_replace_all(c("Duck"="DU","DUB"="DB","DUG"="DG", "SR45"="SR","Griffy"="GR","YW"="TC"))


# summary(seedling_data)
# unique(seedling_data$species)
seedling_data <- filter(seedling_data, is.na(species)=="FALSE")
# filter(seedling_data, rgr_ht<0)
seedling_data <- seedling_data %>% 
  rename(age = forest_age) %>%
  mutate(habitat_type = if_else(distance<10,0,ifelse(distance>20, 2, 1)),
         # age = if_else(age=="young", "Young forest", "Mature forest"),
         rgr_ht_days = (log(final_ht06)) - log((initial_ht))/822)
## This calculates relative growth rate per day
## There are 97 negative values in this growth rate. Values are sometimes very inconsistent from the spring 2006 measurement to the final measurement
seedling_data$common_name <- "NA"
seedling_data$common_name[seedling_data$species=="D"] <- "Dogwood"
seedling_data$common_name[seedling_data$species=="A"] <- "Autumn olive"
seedling_data$common_name[seedling_data$species=="H"] <- "Honeysuckle"
seedling_data$common_name[seedling_data$species=="P"] <- "Privet"
seedling_data$common_name[seedling_data$species=="R"] <- "Redbud"
seedling_data$common_name[seedling_data$species=="S"] <- "Spicebush"

seedling_data$common_name <- factor(
  seedling_data$common_name, levels = c("Autumn olive","Honeysuckle","Privet","Dogwood","Redbud","Spicebush"))

seedling_data$status[seedling_data$status=="n"] <- "Native"
seedling_data$status[seedling_data$status=="e"] <- "Non-native"

seedling_data$status <- factor(seedling_data$status, levels = c("Native","Non-native"))

# summary(germination_data)
# unique(germination_data$species)
# filter(germination_data, is.na(seeds_germinated))$comments
germination_data$common_name <- "NA"
germination_data$sci_name = "NA"
germination_data <- germination_data %>% 
  mutate(pct_germinated = 100*(seeds_germinated/seeds_present),
         status = native_exotic,
         habitat_type = if_else(distance<10,0,ifelse(distance>20, 2, 1)))
```

```{r munge site data}

# summary(forest_data)
forest_data <- forest_data %>% 
  rename(distance = dist) %>% 
  mutate(basal_area_m2_ha = trees_in*10*(.0929/.404686))

# unique(forest_data$species)
# filter(forest_data, is.na(species))
forest_distance_data <- forest_data %>% 
  group_by(site_code, age, distance) %>% 
  summarise(
    tree_richness = n_distinct(species),
    avg_dbh = mean(dbh_cm, na.rm = T),
    se_dbh = sd(dbh_cm, na.rm = T)/sqrt( (6 - length(dbh_cm)) ),#6 NA values in DBH
    total_dbh = sum(dbh_cm, na.rm = T),
    avg_basal_area = mean(basal_area_m2_ha, na.rm = T)
  ) %>% 
  ungroup(.)
# 
forest_habitat_data <- forest_data %>%
  mutate(habitat_type = if_else(distance<10,0,ifelse(distance>20, 2, 1))) %>% 
  group_by(site_code, age, habitat_type) %>%
  summarise(
    richness = n_distinct(species),
    avg_dbh = mean(dbh_cm, na.rm = T),
    se_dbh = sd(dbh_cm, na.rm = T)/sqrt(length(dbh_cm)),#6 NA values in DBH
    total_dbh = sum(dbh_cm, na.rm = T),
    avg_basal_area = mean(basal_area_m2_ha, na.rm = T)
  ) %>%
  ungroup(.)

# summary(light_data)
light_distance_data <- light_data %>% 
  group_by(site_code, age, distance) %>% 
  summarise(avg_ppfd = mean(ppfd),
            avg_pct_light = mean(pct_light)) %>% 
  ungroup(.)
light_habitat_data <- light_data %>%
  mutate(habitat_type = if_else(distance<10,0,ifelse(distance>20, 2, 1))) %>% 
  group_by(site_code, age, habitat_type) %>%
  summarise(avg_ppfd = mean(ppfd),
            avg_pct_light = mean(pct_light),
            se_pct_light = sd(pct_light)/sqrt(length(pct_light))) %>%
  ungroup(.)


# summary(litter_data)
litter_data <- litter_data %>% 
  rename(distance = dist) %>% 
  mutate(litter_kg_m2 = litter*(.001/.0625))
# .25*.25 = .0625 m^2
# 1 g = .001 kg
litter_habitat_data <- litter_data %>%
  mutate(habitat_type = if_else(distance<10,0,ifelse(distance>20, 2, 1))) %>% group_by(site_code, age, habitat_type) %>%
  summarise(avg_litter_kg_m2 = mean(litter_kg_m2),
            se_litter_kg_m2 = sd(litter_kg_m2)/sqrt(length(litter_kg_m2)))

# summary(soil_moisture_data)
soil_moisture_habitat_data <- soil_moisture_data %>%
  mutate(habitat_type = if_else(distance<10,0,ifelse(distance>20, 2, 1))) %>%
  group_by(site_code, age, habitat_type) %>%
  summarise(avg_soil_moisture = mean(pct_moisture),
            se_soil_moisture = sd(pct_moisture)/sqrt(length(pct_moisture)))

```

```{r join site to seedling data}

seedling_data <- seedling_data %>% 
  mutate(age = ifelse(age=="young", "Y","M"),
         stem_leaf_ratio = stem_biomass/leaf_biomass) %>%
  left_join(., forest_distance_data) %>% 
  left_join(., light_distance_data) %>% 
  left_join(., litter_data) %>% 
  left_join(., soil_moisture_data) %>% 
  mutate(age = ifelse(age=="Y","Young forest","Mature forest"))

```


```{r site grouped data}

## This site-grouped data should be used for fitting mixed-effects models
## using site_code as a random effect.
site_grouped_data <- seedling_data %>%
  group_by(site_code, age, distance, common_name, status) %>% 
  summarise(avg_biomass = mean(tot_biomass, na.rm = T),
            # n_obs = length(tot_biomass),
            se_biomass = sd(tot_biomass, na.rm = T)/sqrt(length(tot_biomass)),
            avg_diameter = mean(diameter06, na.rm = T),
            se_diameter = sd(diameter06, na.rm = T)/sqrt(length(diameter06)),
            avg_rgr_ht = mean(rgr_ht_days, na.rm = T),
            se_rgr_ht = sd(rgr_ht_days, na.rm = T)/sqrt(length(rgr_ht_days)),
            avg_height = mean(final_ht06, na.rm = T),
            se_height = sd(final_ht06, na.rm = T)/sqrt(length(final_ht06)),
            avg_num_leaves = mean(num_leaves, na.rm = T),
            se_num_leaves = sd(num_leaves)/sqrt(length(num_leaves)),
            tree_richness = mean(tree_richness),
            avg_dbh = mean(avg_dbh),
            se_dbh = mean(se_dbh),
            total_dbh = mean(total_dbh),
            avg_basal_area = mean(avg_basal_area),
            avg_ppfd = mean(avg_ppfd),
            avg_pct_light = mean(avg_pct_light),
            litter_kg_m2 = mean(litter_kg_m2),
            pct_moisture = mean(pct_moisture)) %>% 
  ungroup(.)

```

```{r distance grouped data}

distance_grouped_data <- seedling_data %>%
  # rename(age = forest_age) %>%
  group_by(age, distance, common_name, status) %>% 
  summarise(avg_biomass = mean(tot_biomass, na.rm = T),
            # n_obs = length(tot_biomass),
            se_biomass = sd(tot_biomass, na.rm = T)/sqrt(length(tot_biomass)),
            avg_diameter = mean(diameter06, na.rm = T),
            se_diameter = sd(diameter06, na.rm = T)/sqrt(length(diameter06)),
            avg_rgr_ht = mean(rgr_ht_days, na.rm = T),
            se_rgr_ht = sd(rgr_ht_days, na.rm = T)/sqrt(length(rgr_ht_days)),
            avg_height = mean(final_ht06, na.rm = T),
            se_height = sd(final_ht06, na.rm = T)/sqrt(length(final_ht06)),
            avg_num_leaves = mean(num_leaves, na.rm = T),
            se_num_leaves = sd(num_leaves)/sqrt(length(num_leaves)),
            tree_richness = mean(tree_richness),
            avg_dbh = mean(avg_dbh),
            se_dbh = mean(se_dbh),
            total_dbh = mean(total_dbh),
            avg_basal_area = mean(avg_basal_area),
            avg_ppfd = mean(avg_ppfd),
            avg_pct_light = mean(avg_pct_light),
            litter_kg_m2 = mean(litter_kg_m2),
            pct_moisture = mean(pct_moisture)) %>% 
  ungroup(.)

```

```{r habitat type grouped data}

habitat_grouped_data <- seedling_data %>% 
  group_by(age, habitat_type, common_name, status) %>% 
  summarise(avg_biomass = mean(tot_biomass, na.rm = T),
            # n_obs = length(tot_biomass),
            se_biomass = sd(tot_biomass, na.rm = T)/sqrt(length(tot_biomass)),
            avg_diameter = mean(diameter06, na.rm = T),
            se_diameter = sd(diameter06, na.rm = T)/sqrt(length(diameter06)),
            avg_rgr_ht = mean(rgr_ht_days, na.rm = T),
            se_rgr_ht = sd(rgr_ht_days, na.rm = T)/sqrt(length(rgr_ht_days)),
            avg_height = mean(final_ht06, na.rm = T),
            se_height = sd(final_ht06, na.rm = T)/sqrt(length(final_ht06)),
            avg_num_leaves = mean(num_leaves, na.rm = T),
            se_num_leaves = sd(num_leaves)/sqrt(length(num_leaves)),
            tree_richness = mean(tree_richness),
            avg_dbh = mean(avg_dbh),
            se_dbh = mean(se_dbh),
            total_dbh = mean(total_dbh),
            avg_basal_area = mean(avg_basal_area),
            avg_ppfd = mean(avg_ppfd),
            avg_pct_light = mean(avg_pct_light),
            litter_kg_m2 = mean(litter_kg_m2),
            pct_moisture = mean(pct_moisture)) %>% 
  ungroup(.)

habitat_grouped_data$f_habitat <- factor(habitat_grouped_data$habitat_type, levels = c("0","1","2"), labels = c("0-5 m","10-20 m","40-60 m"))

# summary(habitat_grouped_data)
```

```{r join site to germination data}

germination_data <- germination_data %>%
  rename(age = forest_age) %>% 
  left_join(., forest_distance_data) %>% 
  left_join(., light_distance_data) %>% 
  left_join(., litter_data) %>% 
  left_join(., soil_moisture_data)

# xtabs(~ species + native_exotic, germination_data)

```

***

```{r make species table}
germination_data$common_name[germination_data$species=="D"] <- "Dogwood"
germination_data$common_name[germination_data$species=="A"] <- "Autumn olive"
germination_data$common_name[germination_data$species=="H"] <- "Honeysuckle"
germination_data$common_name[germination_data$species=="P"] <- "Privet"
germination_data$common_name[germination_data$species=="R"] <- "Redbud"
germination_data$common_name[germination_data$species=="S"] <- "Spicebush"

germination_data$sci_name[germination_data$species=="A"] <- "Elaeagnus umbellata"
germination_data$sci_name[germination_data$species=="H"] <- "Lonicera maackii"
germination_data$sci_name[germination_data$species=="P"] <- "Ligustrum obtusifolium"
germination_data$sci_name[germination_data$species=="D"] <- "Cornus florida"
germination_data$sci_name[germination_data$species=="R"] <- "Cercis canadensis"
germination_data$sci_name[germination_data$species=="S"] <- "Lindera benzoin"

germination_data$status[germination_data$status=="N"] <- "Native"
germination_data$status[germination_data$status=="E"] <- "Non-native"

species_table <- germination_data %>% 
  filter(site_code=="BB", distance==0) %>%
  select(species, status, common_name, sci_name)
  
# kable(species_table %>% 
#         mutate(Species = paste(common_name, " ", "(", sci_name, ")", sep="")) %>% 
#         select(Species, Status = status) %>%
#         arrange(Status)
#       )
```

|Species                            |Status     |
|:----------------------------------|:----------|
|Dogwood (*Cornus florida*)           |Native     |
|Redbud (*Cercis canadensis*)         |Native     |
|Spicebush (*Lindera benzoin*)        |Native     |
|Autumn olive (*Elaeagnus umbellata*) |Non-native |
|Honeysuckle (*Lonicera maackii*)     |Non-native |
|Privet (*Ligustrum obtusifolium*)    |Non-native |

***

# Experiment A: Seed germination

* Ten seeds from each of six species (3 invaders, 3 natives) were placed at each distance at each site.

***

# Experiment B: Seedling survival and growth

* Seedlings of six species (3 invaders, 3 natives) were planted at 12 forest sites classified as mature (>60 years) or young (<40 years).  

* Four seedlings of each species at distances of 0, 5, 10, 20, 40, and 60 meters from the roadway edge. 

* All seedlings were 10-15cm tall when planted

***

**H1:** There is a negative effect on survival and growth for all species moving from edge to interior

* Performance will also be poorer in mature versus young forests
    

**H2:** Non-native species perform relatively better near the edge and in young forests.

* Native species perform relatively better in interior locations and in mature forests

***

# Site data
We measured environmental and forest structure characteristics at each distance along each transect at each site.

## Trees
A 10-BAF wedge prism was used to quantify basal area. We identified and measured the DBH of the five nearest trees that were counted as "in" using the wedge prism.

```{r trees}

forest_data$age[forest_data$age=="M"] <- "Mature forest"
forest_data$age[forest_data$age=="Y"] <- "Young forest"
# levels(forest_data$age) <- c("Mature","Young")
forest_data <- forest_data %>% 
  mutate(habitat_type = if_else(distance<10,0,ifelse(distance>20, 2, 1)),
         f_habitat = factor(habitat_type, levels = c("0","1","2"), labels = c("0-5 m","10-20 m","40-60 m")))

#  Basal area calculation: "trees_in"*10 = basal area (ft^2 acre^-1)
#  Conversion to m^2 ha^-1: 1 acre = .404686 hectares; 1 ft^2 = .0929 m^2
# forest_data <- forest_data %>%
#   mutate(basal_area_m2_ha = trees_in*10*(.0929/.404686))



## DBH plot
# ggplot(forest_data, aes(distance, dbh_cm, shape = age, color = age)) +
#   scale_shape_manual(values = c(16,15)) +
#   stat_summary(fun.data = "mean_se", geom = "pointrange", size = .7) +
#   color_manual +
#   theme_classic() +
#   theme(legend.title = element_blank()) +
#   xlab("Distance from road (m)") +
#   ylab("DBH (cm)")

## Basal area plot
ggplot(forest_data, aes(distance, basal_area_m2_ha, shape = age, color = age)) +
  scale_shape_manual(values = c(16,15)) +
  geom_point() +
  geom_smooth(se = T, show.legend = F, alpha = .2) +
  # stat_summary(fun.data = "mean_se", geom = "pointrange", size = .7) +
  # geom_dotplot(binwidth = .5)
  color_manual +
  theme_classic() +
  theme(legend.title = element_blank()) +
  xlab("Distance from road (m)") +
  ylab(expression(paste("Basal area (", {m}^2, "  ", {ha}^-1, ")")))



## Summarise mean and SE into new dataframe
avg_forest_data <- forest_data %>%
  group_by(age, f_habitat) %>% 
  summarise(
    richness = n_distinct(species),
    avg_dbh = mean(dbh_cm, na.rm = T),
    se_dbh = sd(dbh_cm, na.rm = T)/sqrt(length(dbh_cm)),
    total_dbh = mean(dbh_cm, na.rm = T),
    avg_basal_area = mean(basal_area_m2_ha, na.rm = T),
    se_basal_area = sd(basal_area_m2_ha, na.rm = T)/sqrt(length(basal_area_m2_ha))
  )

# ggplot(avg_forest_data, aes(age, avg_dbh, fill = habitat_type)) +
#   geom_col(position = "dodge") +
#   geom_errorbar(aes(ymin = avg_dbh - se_dbh, ymax = avg_dbh + se_dbh), width = 0, position = position_dodge(width = .9)) +
#   fill_manual +
#   theme_classic() +
#   theme(legend.title = element_blank()) +
#   xlab("") +
#   ylab("DBH (cm)")

ggplot(avg_forest_data, aes(age, avg_basal_area, fill = f_habitat)) +
  geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = avg_basal_area - se_basal_area, ymax = avg_basal_area + se_basal_area), width = 0, position = position_dodge(width = .9)) +
  fill_manual +
  theme_classic() +
  theme(legend.title = element_blank()) +
  xlab("") +
  ylab(expression(paste("Basal area (", {m}^2, "  ", {ha}^-1, ")")))

```

Basal area essentially defines young (<40 years) vs. mature forest (>60 years), although the difference is much smaller at the edge (i.e. 0 m).

```{r tree models, eval=F}
skimr::skim(forest_data)
# library(lme4)
# library(lmerTest)

# dbh_lm <- lmer(basal_area ~ distance*age, data = forest_data)
# plot(dbh_lm)
# summary(dbh_lm)
# dbh_lm2 <- glm(dbh_cm ~ habitat_type*age, data = forest_data)
# summary(dbh_lm2)

basal_area_lm <- glm(basal_area_m2_ha ~ distance*age, data = forest_data)
plot(basal_area_lm)
summary(basal_area_lm)

basal_area_lm2 <- glm(basal_area_m2_ha ~ habitat_type*age, data = forest_data)
plot(basal_area_lm2)
summary(basal_area_lm2)

```

## Light availability
In the summer of 2005, photosynthetically active radiation (PAR) was measured as photosynthetic photon flux density (PPFD) at five locations at each distance at each site along a 5 m long transect parallel to the road. From these measurements, we calculated the percent available light at each location as the ratio of the PAR value to the PAR value measured in open sun.

```{r light}

light_data$age[light_data$age=="M"] <- "Mature forest"
light_data$age[light_data$age=="Y"] <- "Young forest"
light_data <- light_data %>% 
  mutate(habitat_type = if_else(distance<10,0,ifelse(distance>20, 2, 1)),
         f_habitat = factor(habitat_type, levels = c("0","1","2"), labels = c("0-5 m","10-20 m","40-60 m")))

# skimr::skim(light_data)

ggplot(light_data, aes(distance, (pct_light), shape = age, color = age)) +
  scale_shape_manual(values = c(16,15)) +
  stat_summary(fun.data = "mean_se", geom = "pointrange", size = .7) +
  # geom_smooth(method = "lm", alpha = .2, se = F) +
  # geom_line(aes(linetype = age)) +
  color_manual +
  theme_classic() +
  theme(legend.title = element_blank()) +
  xlab("Distance from road (m)") +
  ylab("Light (%)")

# qplot(habitat_type, pct_light, data = light_data, geom = "boxplot")

avg_light_data <- light_data %>% 
  group_by(age, f_habitat) %>% 
  summarise(avg_pct_light = mean(pct_light),
            se_pct_light = sd(pct_light)/length(pct_light))

ggplot(avg_light_data, aes(age, avg_pct_light, fill = f_habitat)) +
  geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = avg_pct_light - se_pct_light, ymax = avg_pct_light + se_pct_light), width = 0, position = position_dodge(width = .9)) +
  fill_manual +
  # scale_fill_manual(values = c("grey90","grey50")) +
  theme_classic() +
  theme(legend.title = element_blank()) +
  xlab("") +
  ylab("Light (%)")

```

Light availability decreases with distance to road with no overall difference between forest age, however, there is substantial variation within and between forest age depending on the specific distance. Averaged across forest age, light availability was greater at the forest edge (0 m) compared to other distances. At mature forest sites, light availability was greatest at the forest edge (0 m), but at young forest sites it was greatest at 20 m from the edge. 

Basically this is a noisy and non-linear relationship. What I would generally expect is relatively high light availability at the edge, then a rapid decline to a steady-state as you move into the forest. 

```{r light models, eval=F}

light_lm <- glm(log10(pct_light) ~ factor(distance)*age, data = light_data)
plot(light_lm)
summary(light_lm)

# summary(MASS::glm.nb(pct_light ~ distance, data = light_data))

light_lm2 <- glm((pct_light) ~ habitat_type, data = light_data)
plot(light_lm2)
summary(light_lm2)

car::Anova(light_lm)

t.test(log10(pct_light) ~ distance, data = filter(light_data, distance==0|distance==40))

```

## Soil moisture
In the summer of 2005, we also collected 125 cm^3^ mineral soil samples at the center of each 5 m transect to measure gravimetric water content.

```{r soil}

soil_moisture_data$age[soil_moisture_data$age=="M"] <- "Mature forest"
soil_moisture_data$age[soil_moisture_data$age=="Y"] <- "Young forest"

ggplot(soil_moisture_data, aes(distance, pct_moisture, shape = age, color = age)) +
  scale_shape_manual(values = c(16,15)) +
  stat_summary(fun.data = "mean_se", geom = "pointrange", size = .7) +
  # geom_smooth(method = "lm", se = F, show.legend = F) +
  color_manual +
  theme_classic() +
  theme(legend.title = element_blank()) +
  xlab("Distance from road (m)") +
  ylab("Soil moisture (%)")


# ggplot(soil_moisture_data, aes(age, pct_moisture, fill = habitat_type)) +
#   geom_boxplot(notch = F) +
#   # geom_violin() +
#   scale_fill_manual(values = c("black", "grey90")) +
#   theme_classic()

## Pooled soil moisture data
# ggplot(soil_moisture_data, aes(distance, pct_moisture)) +
#   # scale_shape_manual(values = c(16,15)) +
#   stat_summary(fun.data = "mean_se", geom = "pointrange", size = .7) +
#   # scale_color_manual(values = c("black", "grey65")) +
#   theme_classic()

soil_moisture_habitat_data$f_habitat <- factor(soil_moisture_habitat_data$habitat_type, levels = c("0","1","2"), labels = c("0-5 m","10-20 m","40-60 m"))
soil_moisture_habitat_data$age[soil_moisture_habitat_data$age=="M"] <- "Mature forest"
soil_moisture_habitat_data$age[soil_moisture_habitat_data$age=="Y"] <- "Young forest"

avg_soil_data <- soil_moisture_habitat_data %>%
  group_by(age, f_habitat) %>%
  summarise(avg_pct_moisture = mean(avg_soil_moisture),
            se_pct_moisture = sd(avg_soil_moisture)/length(avg_soil_moisture))

ggplot(avg_soil_data, aes(age, avg_pct_moisture, fill = f_habitat)) +
  geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = avg_pct_moisture - se_pct_moisture, ymax = avg_pct_moisture + se_pct_moisture), width = 0, position = position_dodge(width = .9)) +
  fill_manual +
  theme_classic() +
  theme(legend.title = element_blank()) +
  xlab("") +
  ylab("Soil moisture (%)")

# soil_lm <- lm(pct_moisture ~ (distance), data = soil_moisture_data)
# summary(soil_lm)
# car::Anova(soil_lm, type = 3)
## Slope of the overall average line is

# soil_lm2 <- lm(pct_moisture ~ factor(distance), data = soil_moisture_data)
# summary(soil_lm2)
## No overall statistical differences between 0 meter and other distances

```

Overall, soil moisture incarease further from the edge (p = .055), with a stronger relationship at young forest sites than mature forest sites (not significant except at 60 m). Still, the effective difference in the average soil moisture is only a couple percentage points.

## Litter
We collected leaf litter from within a 25 cm x 25 cm PVC frame at each of the six distances from roads at each site in December 2008

```{r litter}

litter_data$age[litter_data$age=="M"] <- "Mature forest"
litter_data$age[litter_data$age=="Y"] <- "Young forest"
litter_data <- litter_data %>% 
  mutate(habitat_type = if_else(distance<10,0,ifelse(distance>20, 2, 1)),
         f_habitat = factor(habitat_type, levels = c("0","1","2"), labels = c("0-5 m","10-20 m","40-60 m")))

ggplot(litter_data, aes(distance, litter_kg_m2, shape = age, color = age)) +
  scale_shape_manual(values = c(16,15)) +
  stat_summary(fun.data = "mean_se", geom = "pointrange", size = .7) +
  # geom_smooth(method = "lm", se = F, show.legend = F) +
  color_manual +
  theme_classic() +
  theme(legend.title = element_blank()) +
  xlab("Distance from road (m)") +
  ylab(expression(paste("Litter (kg ", {m}^-2, ")")))


avg_litter_data <- litter_data %>% 
  group_by(age, f_habitat) %>% 
  summarise(avg_litter_kg_m2 = mean(litter_kg_m2),
            se_litter_kg_m2 = sd(litter_kg_m2)/length(litter_kg_m2))

ggplot(avg_litter_data, aes(age, avg_litter_kg_m2, fill = f_habitat)) +
  geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = avg_litter_kg_m2 - se_litter_kg_m2, ymax = avg_litter_kg_m2 + se_litter_kg_m2), width = .1, position = position_dodge(width = .9)) +
  fill_manual +
  theme_classic() +
  theme(legend.title = element_blank()) +
  xlab("") +
  ylab(expression(paste("Litter (kg ", {m}^-2, ")")))

# litter_lm <- lm(litter_kg_m2 ~ distance*age, data = litter_data)
# summary(litter_lm)
# litter_lm2 <- lm(litter_kg_m2 ~ habitat_type*age, data = litter_data)
# summary(litter_lm2)
# 
# AIC(litter_lm)
# AIC(litter_lm2)

```

Litter is greater in mature forests than young forests, but decreases with distance from edge after 5 meters in mature forests and increases with distance from edge in young forests. Litter may be especially important for modeling germination.


*** 

# Species data

For all of these, the solid-fill symbols should be the non-native species.

## Experiment 1: Seed germination

```{r germination}

# names(germination_data)
germination_data$age[germination_data$age=="Y"] <- "Young forest"
germination_data$age[germination_data$age=="M"] <- "Mature forest"
germination_data$f_habitat <- factor(germination_data$habitat_type, levels = c("0","1","2"), labels = c("0-5 m","10-20 m","40-60 m"))

germination_data$common_name <- factor(
  germination_data$common_name, levels = c("Autumn olive","Honeysuckle","Privet","Dogwood","Redbud","Spicebush"))
germination_data$status <- factor(germination_data$status, levels = c("Native","Non-native"))

germination_distance_data <- germination_data %>% 
  group_by(status, distance, common_name, age) %>% 
  summarise(avg_germinated = mean(pct_germinated, na.rm = T))

germination_habitat_data <- germination_data %>% 
  group_by(status, f_habitat, habitat_type, common_name, age) %>% 
  summarise(avg_germinated = mean(pct_germinated, na.rm = T))


ggplot(germination_data, aes(distance, pct_germinated)) +
  stat_summary(aes(shape = common_name), fun.data = "mean_se", geom = "point", size = 2.5) +
  geom_smooth(aes(linetype = status), method = "lm", se = F, show.legend = F, color = "grey40", size = .8) +
  # scale_shape_manual(values = c(rep(16, 3), rep(17, 3))) +
  # scale_color_manual(values = c(brewer.pal(3, "RdBu"), brewer.pal(3, "RdBu"))) +
  scale_linetype_manual(values = c(2,1)) +
  # scale_color_brewer(palette = "RdBu") +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Percent germination") +
  xlab("Distance from road (m)")

# ggsave("figures/pct_germinated.png", dpi = 600, width = 7, height = 3.5)

ggplot(germination_distance_data, aes(distance, avg_germinated)) +
  geom_point(aes(shape = common_name), show.legend = T, size = 2.5) +
  geom_line(aes(linetype = common_name)) +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Percent germination") +
  xlab("Distance from road (m)")

ggplot(germination_habitat_data, aes(f_habitat, avg_germinated)) +
  geom_point(aes(shape = common_name), show.legend = T, size = 2.5) +
  geom_line(aes(linetype = common_name, group = common_name)) +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Percent germination") +
  xlab("Distance from road")

```

Although the relationship between germination and distance from edge was non-linaer, germination was greater overall for non-native than native species and tended to increase with distance for both groups in mature forests. In young forests, germination of native species had a small negative relationship with distance from edge. The greater germination success of non-native species was driven by autumnn olive, which had the highest average germination rate in each forest age (mature: `r mean(filter(germination_data, species=="A", age=="Mature forest")$pct_germinated, na.rm=T)`, young: `r mean(filter(germination_data, species=="A", age=="Young forest")$pct_germinated, na.rm=T)`).

```{r germination averages table, results='asis'}
kable(germination_data %>% 
  group_by(common_name, age, status) %>% 
  summarise(avg_pct_germ = mean(pct_germinated, na.rm = T)) %>% 
  spread(key = age, value = avg_pct_germ) %>% 
  rename(Species = common_name, Status = status), 
  digits = 2, caption = "Average germination (%) of seeds for each species in each forest age.")
```


## Experiment 2: Seedling growth and survival

```{r seedling data manipulation}

# names(seedling_data)

seedling_data$age[seedling_data$age=="young"] <- "Young forest"
seedling_data$age[seedling_data$age=="mature"] <- "Mature forest"

seedling_data$f_habitat <- factor(seedling_data$habitat_type, levels = c("0","1","2"), labels = c("0-5 m","10-20 m","40-60 m"))

distance_grouped_data$age[distance_grouped_data$age=="Y"] <- "Young forest"
distance_grouped_data$age[distance_grouped_data$age=="M"] <- "Mature forest"

habitat_grouped_data$age[habitat_grouped_data$age=="Y"] <- "Young forest"
habitat_grouped_data$age[habitat_grouped_data$age=="M"] <- "Mature forest"
```


### Seedling survival
```{r survival}

surv <- select(seedling_data, site_name:status, habitat_type, f_habitat, common_name, starts_with("surv"))
surv <- surv %>% gather(year, survival, survival04:survival06)
surv$year[surv$year=="survival04"] <- 2004
surv$year[surv$year=="survival05"] <- 2005
surv$year[surv$year=="survival06"] <- 2006

survival_distance_data <- surv %>% 
  group_by(year, distance, age, status, common_name) %>% 
  filter(!is.na(survival), year==2006) %>% 
  summarise(pct_survival = 100*sum(survival)/length(survival))

survival_habitat_data <- surv %>% 
  group_by(year, habitat_type, f_habitat, age, status, common_name) %>% 
  filter(!is.na(survival), year==2006) %>% 
  summarise(pct_survival = 100*sum(survival)/length(survival))

ggplot(survival_distance_data, aes(distance, pct_survival)) +
  stat_summary(aes(shape = common_name), fun.data = "mean_se", geom = "point", size = 2.5) +
  geom_smooth(aes(linetype = status), method = "lm", se = F, show.legend = F, color = "grey50", size = .8) +
  scale_linetype_manual(values = c(2,1)) +
  scale_color_brewer(palette = "RdBu") +
  facet_grid(.~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Survival (%)") +
  xlab("Distance from road (m)") +
  ggtitle("Average seedling survival to 2006")


ggplot(survival_distance_data, aes(distance, pct_survival)) +
  # geom_smooth(aes(linetype = common_name), method = "lm", se = F, show.legend = T, color = "grey50", size = .5) +
  geom_point(aes(shape = common_name), size = 2.5, show.legend = T) +
  geom_line(aes(linetype = common_name)) +
  # stat_summary(aes(shape = common_name), fun.data = "mean_se", geom = "point", size = 2.5, show.legend = F) +
  # scale_linetype_manual(values = c(2,1)) +
  # scale_color_brewer(palette = "RdBu") +
  facet_grid(.~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Survival (%)") +
  xlab("Distance from road (m)") +
  ggtitle("Average seedling survival to 2006")


ggplot(survival_habitat_data, aes(f_habitat, pct_survival)) +
  # geom_smooth(aes(linetype = common_name), method = "lm", se = F, show.legend = T, color = "grey50", size = .5) +
  geom_point(aes(shape = common_name), size = 2.5, show.legend = F) +
  geom_line(aes(linetype = common_name, group = common_name)) +
  facet_grid(.~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Survival (%)") +
  xlab("Distance from edge") +
  ggtitle("Average seedling survival to 2006")

# filter(surv, year == 2006) %>% 
#   group_by(status, age) %>% 
#   summarise(avg_pct_survival = mean(pct_survival))
```

Seedling survival over the duration of the experiment was high across sites and species (`r mean(surv$pct_survival)`). Autumn olive and dogwood had relatively low survival compared to the other species (AO: 49% mature, 50.7% young; DW: 60.4% mature, 41.7% young). Seedling survival for all other species averaged greater than 80%. In mature forests, autumn olive and dogwood both had lower survival with increasing distance from the edge, but in young forest autumn olive tended to have greater survival farther from the edge. 

While these general linear trends with distance are present, the precise relationship with distance from edge is non-linear across all species. In mature forests, most species showed greatest survival at 5 and 10 m from the edge, with the exception of honeysuckle, which had greatest survival at distances of 20 m and greater. Honeysuckle also had the greatest proportion of overall surviving seedlings (94.8%). In contrast, seedling survival in young forests was overall lower for native than non-native species, and also lower at interior versus edge locations for native species, except for spicebush. 


### Seedling height
```{r seedling_height}

ggplot(seedling_data, aes(avg_pct_light, final_ht06)) +
  # stat_summary(aes(shape = common_name), fun.data = "mean_se", geom = "point", size = 2.5) +
  geom_point(aes(color = status, alpha = distance)) +
  geom_smooth(aes(linetype = status), method = "lm", se = F, show.legend = F, color = "grey50") +
  scale_linetype_manual(values = c(2,1)) +
  # scale_color_brewer(palette = "RdBu") +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Height (cm)") +
  xlab("Distance from road (m)")


ggplot(distance_grouped_data, aes(distance, avg_height)) +
  geom_point(aes(shape = common_name), size = 2.5, position = position_dodge(5)) +
  geom_line(aes(linetype = common_name), position = position_dodge(5)) +
  geom_errorbar(aes(ymin = avg_height-se_height, ymax = avg_height+se_height), width = .1, position = position_dodge(5)) +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Height (cm)") +
  xlab("Distance from road (m)")


ggplot(habitat_grouped_data, aes(f_habitat, avg_height)) +
  geom_point(aes(shape = common_name), size = 2.5) +
  geom_line(aes(linetype = common_name, group = common_name)) +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Height (cm)") +
  xlab("Distance")

```


### Seedling diameter
```{r seedling_diameter}

ggplot(seedling_data, aes(avg_pct_light, diameter06)) +
  # stat_summary(aes(shape = common_name), fun.data = "mean_se", geom = "point", size = 2.5) +
  geom_point(aes(color = status, alpha = distance)) +
  geom_smooth(aes(linetype = status), method = "lm", se = F, show.legend = F, color = "grey20") +
  scale_linetype_manual(values = c(2,1)) +
  # scale_color_brewer(palette = "RdBu") +
  facet_grid(.~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Diameter (mm)") +
  xlab("Distance from road (m)")


ggplot(distance_grouped_data, aes(distance, avg_diameter)) +
  geom_point(aes(shape = common_name), size = 2.5) +
  geom_line(aes(linetype = common_name)) +
  geom_errorbar(aes(ymin = avg_diameter-se_diameter, ymax = avg_diameter+se_diameter), width = .1) +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Diameter (mm)") +
  xlab("Distance from road (m)")

ggplot(habitat_grouped_data, aes(f_habitat, avg_diameter)) +
  geom_point(aes(shape = common_name), size = 2.5) +
  geom_line(aes(linetype = common_name, group = common_name)) +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Diameter (mm)") +
  xlab("Distance")

```


### Seedling biomass
```{r seedling_biomass}

ggplot(seedling_data, aes(distance, tot_biomass)) +
  geom_smooth(aes(linetype = status), method = "lm", se = F, show.legend = F, color = "grey50", size = .8) +
  stat_summary(aes(shape = common_name), fun.data = "mean_se", geom = "point" ) +
  scale_linetype_manual(values = c(2,1)) +
  scale_color_brewer(palette = "RdBu") +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Biomass (g)") +
  xlab("Distance from road (m)")


ggplot(distance_grouped_data, aes(distance, avg_biomass)) +
  geom_line(aes(linetype = common_name, group = common_name)) +
  # geom_smooth(aes(linetype = status), method = "lm", se = F) +
  geom_point(aes(shape = common_name), size = 2.5) +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Biomass (g)") +
  xlab("Distance from road (m)")

ggplot(habitat_grouped_data, aes(f_habitat, avg_biomass)) +
  geom_line(aes(linetype = common_name, group = common_name)) +
  # geom_smooth(aes(linetype = status), method = "lm", se = F) +
  geom_point(aes(shape = common_name), size = 2.5) +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Biomass (g)") +
  xlab("Distance")

```


### Seedling relative growth rate (height)
```{r rel_growth}

ggplot(seedling_data, aes(distance, rgr_ht_days)) +
  stat_summary(aes(shape = common_name), fun.data = "mean_se", geom = "point", size = 2.5) +
  geom_smooth(aes(linetype = status), method = "lm", se = F, show.legend = F, color = "grey50") +
  scale_linetype_manual(values = c(2,1)) +
  scale_color_brewer(palette = "RdBu") +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Relative growth rate (% / day)") +
  xlab("Distance from road (m)") 


ggplot(distance_grouped_data, aes(distance, avg_rgr_ht)) +
  geom_point(aes(shape = common_name)) +
  geom_line(aes(linetype = common_name)) +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Relative growth rate (% / day)") +
  xlab("Distance from road (m)") 


ggplot(habitat_grouped_data, aes(f_habitat, avg_rgr_ht)) +
  geom_point(aes(shape = common_name)) +
  geom_line(aes(linetype = common_name, group = common_name)) +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Relative growth rate (% / day)") +
  xlab("Distance") 

```


### Seedling herbivory
```{r herbivory}

# names(seedling_data)

herbiv <- select(seedling_data, site_name:status, habitat_type, f_habitat, common_name, starts_with("herb"))
herbiv <- herbiv %>% 
  gather(year, herbivory, herbivory04:herbivory06)
herbiv$year[herbiv$year=="herbivory04"] <- 2004
herbiv$year[herbiv$year=="herbivory05"] <- 2005
herbiv$year[herbiv$year=="herbivory06"] <- 2006

ggplot(filter(herbiv, year == 2006), aes(distance, herbivory)) +
  stat_summary(aes(shape = common_name), fun.data = "mean_se", geom = "point", size = 2.5) +
  geom_smooth(aes(linetype = status), method = "lm", se = F, show.legend = F, color = "grey50") +
  scale_linetype_manual(values = c(2,1)) +
  scale_color_brewer(palette = "RdBu") +
  facet_grid(.~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Herbivory score") +
  xlab("Distance from road (m)") 

herbiv_distance_data <- herbiv %>%
  filter(year == "2006") %>%
  group_by(distance, status, age, common_name) %>% 
  summarise(avg_herbivory = mean(herbivory, na.rm = T),
            se_herbivory = sd(herbivory, na.rm = T)/sqrt(length(herbivory)))

herbiv_habitat_data <- herbiv %>%
  filter(year == "2006") %>%
  group_by(habitat_type, f_habitat, status, age, common_name) %>% 
  summarise(avg_herbivory = mean(herbivory, na.rm = T),
            se_herbivory = sd(herbivory, na.rm = T)/sqrt(length(herbivory)))

ggplot(herbiv_distance_data, aes(distance, avg_herbivory)) +
  geom_line(aes(linetype = common_name), show.legend = F) +
  geom_point(aes(shape = common_name), size = 2.5) +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Herbivory score") +
  xlab("Distance from road (m)")

ggplot(herbiv_habitat_data, aes(f_habitat, avg_herbivory)) +
  geom_line(aes(linetype = common_name, group = common_name), show.legend = F) +
  geom_point(aes(shape = common_name), size = 2.5) +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Herbivory score") +
  xlab("Distance")

```

In young forests, herbivory increased with distance from edge for both native and non-native species, but decreased with distance from edge for native species in mature forests. There was no relationship between distance from edge and herbivory for non-native species in mature forests. Herbivory was greater on native than non-native species in both forest types.

Herbivory was categorized, where 1 = 1-25%, 2 = 26-50%, 3 = 51-75%.

What kind of herbivory might this be? Deer? Defoliators?



# Models
```{r models, eval=F}
library(lme4)
# names(grouped_seedling_data)
# summary(grouped_seedling_data)
# grouped_seedling_data
# skimr::skim(grouped_seedling_data)

# a ggplot style pairs plot----
library(GGally)
ggpairs(select(site_grouped_data, avg_biomass, distance, tree_richness, avg_basal_area, avg_pct_light, litter_kg_m2, pct_moisture, age), aes(color = age, alpha = .2))
#relatively strong correlation between basal area and litter; the major differences are related to forest age

# modeling biomass ----

site_grouped_data <- site_grouped_data %>%
  mutate(site_avg_light = mean(avg_pct_light),
         site_avg_basal_area = mean(avg_basal_area),
         site_avg_litter = mean(litter_kg_m2),
         site_avg_moisture = mean(pct_moisture))


# random-effects only
biomass_m1 <- lmer(log(avg_biomass) ~ (1|site_code) + (1|status/common_name) + (1|distance) + (1|age), data = site_grouped_data)
## Age and status have only two categories (groups) which makes them kinda bad random effects; not many groups to average over
plot(biomass_m1)
summary(biomass_m1)
# confint(biomass_m1)
biomass_m1a <- lmer(log(avg_biomass) ~ (1|site_code) + (1|status/common_name) + (1|distance), data = site_grouped_data)
biomass_m1b <- lmer(log(avg_biomass) ~ (1|site_code) + (1|status/common_name), data = site_grouped_data)# assume using distance as continuous predictor
biomass_m1c <- lmer(log(avg_biomass) ~ (1|site_code) + (1|common_name), data = site_grouped_data)# assume 

# library(lmerTest)
biomass_model <- lmer(log(avg_biomass) ~ avg_pct_light*age + litter_kg_m2*age + pct_moisture*age + status*age + (1|site_code) + (1|common_name) + (1|distance), data = site_grouped_data)
plot(biomass_model)
summary(biomass_model)
# anova(biomass_model, type = 3)


biomass_m2 <- lmer(log(avg_biomass) ~ distance + age + avg_pct_light + litter_kg_m2*age + pct_moisture + status*age + (1|site_code) + (1|status) + (1|common_name), data = site_grouped_data)
plot(biomass_m2)
summary(biomass_m2)


biomass_m3 <- lmer(log(avg_biomass) ~ distance + (1|site_code) + (1 + distance|status) + (1|site_code:species), data = site_grouped_data)
plot(biomass_m3)
summary(biomass_m3)


biomass_m4 <- lmer(log(avg_biomass) ~ factor(habitat_type) + status + scale(avg_basal_area) + scale(avg_pct_light) + scale(pct_moisture) + scale(litter) + (1|site_code) + (1|species), data = site_grouped_data)
plot(biomass_m4)
summary(biomass_m4)

confint(biomass_m4, method="Wald")

# (1 + distance|species) +
```


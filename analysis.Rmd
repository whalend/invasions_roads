---
title: "Forest successional age and edge effects on species growth and survival in an experimental plant invasion"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  word_document: null
  html_document:
    toc: yes
---

```{r set options, include=F, echo=F}

knitr::opts_chunk$set(fig.width = 7, fig.height = 3.5)
knitr::opts_chunk$set(dpi = 600)
knitr::opts_chunk$set(echo = F)
knitr::opts_chunk$set(warning = F)
knitr::opts_chunk$set(message = F)
knitr::opts_chunk$set(fig.asp = .5)
# knitr::opts_chunk$set(eval = F)

# options(na.action = "na.fail")# global model setting for using multimodel inference 'dredge' function


fill_manual <- scale_fill_manual(values = c("grey90", "grey50"))
color_manual <- scale_color_manual(values = c("grey50", "grey90"))
```

```{r load packages}
# library(lme4); library(car); library(sciplot); library(lmerTest); 
# library(MuMIn)
library(plyr); library(dplyr); library(tidyr); library(readr)
library(ggplot2)
library(knitr)
```

```{r load data}
seedling_data <- read_csv("data/seedling_growth_survival_data.csv")
germination_data <- read_csv("data/germination_data.csv")
forest_data <- read_csv("data/forest_trees.csv")
light_data <- read_csv("data/light2005_data.csv")
litter_data <- read_csv("data/litter.csv")
soil_moisture_data <- read_csv("data/soil_moisture2005_data.csv")
```

```{r check data}

sites <- data_frame(unique(seedling_data$site_code), unique(seedling_data$site_name))
names(sites) <- c("site_code","site_name")

library(stringr)
germination_data <- rename(germination_data, site_code = site)
# sort(unique(germination_data$site_code))
germination_data$site_code <- germination_data$site_code %>%
  str_sub(., 1,3) %>% 
  str_replace_all(c("Cic"="CH","Dub"="DB","Duc"="DU","Dug"="DG","For"="FR","Gri"="GR","Hdq"="HQ","Lil"="LD","Par"="PR","SR4"="SR","Yel"="TC"))

forest_data <- rename(forest_data, site_code = site)
# unique(forest_data$site_code)
forest_data$site_code <- forest_data$site_code %>% 
  str_replace_all(c("DUCK"="DU","DUB"="DB","DUG"="DG", "SR45"="SR"))

light_data <- rename(light_data, site_code = site)
# unique(light_data$site_code)
light_data$site_code <- light_data$site_code %>% 
  str_replace_all(c("DUCK"="DU","DUB"="DB","DUG"="DG", "SR45"="SR"))

litter_data <- rename(litter_data, site_code = site)
# unique(litter_data$site_code)
litter_data$site_code <- litter_data$site_code %>% 
  str_replace_all(c("DUCK"="DU","DUB"="DB","DUG"="DG", "SR45"="SR"))

soil_moisture_data <- rename(soil_moisture_data, site_code = site)
# unique(soil_moisture_data$site_code)
soil_moisture_data$site_code <- soil_moisture_data$site_code %>% 
  str_replace_all(c("Duck"="DU","DUB"="DB","DUG"="DG", "SR45"="SR","Griffy"="GR","YW"="TC"))


# summary(seedling_data)
# unique(seedling_data$species)
seedling_data <- filter(seedling_data, is.na(species)=="FALSE")
# filter(seedling_data, rgr_ht<0)
seedling_data <- seedling_data %>% 
  rename(age = forest_age) %>% 
  mutate(habitat_type = if_else(distance<20,"Edge","Interior"),
         # age = if_else(age=="young", "Young forest", "Mature forest"),
         rgr_ht_days = (log(final_ht06)) - log((initial_ht))/822)
## This calculates relative growth rate per day
## There are 97 negative values in this growth rate. Values are sometimes very inconsistent from the spring 2006 measurement to the final measurement


# summary(germination_data)
# unique(germination_data$species)
# filter(germination_data, is.na(seeds_germinated))$comments
germination_data$common_name <- "NA"
germination_data$sci_name = "NA"
germination_data <- germination_data %>% 
  mutate(pct_germinated = 100*(seeds_germinated/seeds_present),
         status = native_exotic,
         habitat_type = if_else(distance<20,"Edge","Interior"))

# summary(forest_data)
forest_data <- forest_data %>% 
  rename(distance = dist) %>% 
  mutate(habitat_type = if_else(distance<20,"Edge","Interior"))
# unique(forest_data$species)
# filter(forest_data, is.na(species))
grouped_forest_data <- forest_data %>% 
  mutate(basal_area_m2_ha = trees_in*10*(.0929/.404686)) %>% 
  group_by(site_code, age, distance) %>% 
  summarise(
    richness = n_distinct(species),
    avg_dbh = mean(dbh_cm, na.rm = T),
    se_dbh = sd(dbh_cm, na.rm = T)/sqrt( (6 - length(dbh_cm)) ),#6 NA values in DBH
    total_dbh = sum(dbh_cm, na.rm = T),
    avg_basal_area = mean(basal_area_m2_ha, na.rm = T)
  ) %>% 
  ungroup(.)


# summary(light_data)
light_data <- light_data %>% 
  mutate(habitat_type = if_else(distance<20,"Edge","Interior"))

grouped_light_data <- light_data %>% 
  group_by(site_code, age, distance) %>% 
  summarise(avg_ppfd = mean(ppfd),
            avg_pct_light = mean(pct_light)) %>% 
  ungroup(.)

# summary(litter_data)
litter_data <- litter_data %>% 
  rename(distance = dist) %>% 
  mutate(habitat_type = if_else(distance<20,"Edge","Interior"))

# summary(soil_moisture_data)
soil_moisture_data <- mutate(soil_moisture_data, habitat_type = if_else(distance<20,"Edge","Interior"))



grouped_seedling_data <- seedling_data %>%
  # rename(age = forest_age) %>%
  mutate(age = ifelse(age=="Young", "Y","M"),
         stem_leaf_ratio = stem_biomass/leaf_biomass) %>%
  group_by(site_code, age, distance, species, status) %>% 
  summarise(avg_biomass = mean(tot_biomass, na.rm = T),
            # n_obs = length(tot_biomass),
            se_biomass = sd(tot_biomass, na.rm = T)/sqrt(length(tot_biomass)),
            avg_diameter = mean(diameter06, na.rm = T),
            se_diameter = sd(diameter06, na.rm = T)/sqrt(length(diameter06)),
            avg_rgr_ht = mean(rgr_ht_days, na.rm = T),
            se_rgr_ht = sd(rgr_ht_days, na.rm = T)/sqrt(length(rgr_ht_days))) %>% 
  ungroup(.) %>% 
  left_join(., grouped_forest_data) %>% 
  left_join(., grouped_light_data) %>% 
  left_join(., litter_data) %>% 
  left_join(., soil_moisture_data)


germination_data <- germination_data %>%
  rename(age = forest_age) %>% 
  left_join(., grouped_forest_data) %>% 
  left_join(., grouped_light_data) %>% 
  left_join(., litter_data) %>% 
  left_join(., soil_moisture_data)

# xtabs(~ species + native_exotic, germination_data)

```

***

```{r make species table}
germination_data$common_name[germination_data$species=="D"] <- "Dogwood"
germination_data$common_name[germination_data$species=="A"] <- "Autumn olive"
germination_data$common_name[germination_data$species=="H"] <- "Honeysuckle"
germination_data$common_name[germination_data$species=="P"] <- "Privet"
germination_data$common_name[germination_data$species=="R"] <- "Redbud"
germination_data$common_name[germination_data$species=="S"] <- "Spicebush"

germination_data$sci_name[germination_data$species=="A"] <- "Elaeagnus umbellata"
germination_data$sci_name[germination_data$species=="H"] <- "Lonicera maackii"
germination_data$sci_name[germination_data$species=="P"] <- "Ligustrum obtusifolium"
germination_data$sci_name[germination_data$species=="D"] <- "Cornus florida"
germination_data$sci_name[germination_data$species=="R"] <- "Cercis canadensis"
germination_data$sci_name[germination_data$species=="S"] <- "Lindera benzoin"

germination_data$status[germination_data$status=="N"] <- "Native"
germination_data$status[germination_data$status=="E"] <- "Non-native"

species_table <- germination_data %>% 
  filter(site_code=="BB", distance==0) %>%
  select(species, status, common_name, sci_name)
  
# kable(species_table %>% 
#         mutate(Species = paste(common_name, " ", "(", sci_name, ")", sep="")) %>% 
#         select(Species, Status = status) %>%
#         arrange(Status)
#       )
```

|Species                            |Status     |
|:----------------------------------|:----------|
|Dogwood (*Cornus florida*)           |Native     |
|Redbud (*Cercis canadensis*)         |Native     |
|Spicebush (*Lindera benzoin*)        |Native     |
|Autumn olive (*Elaeagnus umbellata*) |Non-native |
|Honeysuckle (*Lonicera maackii*)     |Non-native |
|Privet (*Ligustrum obtusifolium*)    |Non-native |

***

# Experiment A: Seed germination

* Ten seeds from each of six species (3 invaders, 3 natives) were placed at each distance

***

# Experiment B: Seedling survival and growth

* Seedlings of six species (3 invaders, 3 natives) were planted at 12 forest sites classified as mature (>60 years) or young (<40 years).  

* Four seedlings of each species at distances of 0, 5, 10, 20, 40, and 60 meters from the roadway edge. 

* All seedlings were 10-15cm tall when planted

***

**H1:** There is a negative effect on survival and growth for all species moving from edge to interior

* Performance will also be poorer in mature versus young forests
    

**H2:** Non-native species perform relatively better near the edge and in young forests.

* Native species perform relatively better in interior locations and in mature forests

***

# Site data
We measured environmental and forest structure characteristics at each distance along each transect at each site.

## Trees
A 10-BAF wedge prism was used to quantify basal area. We identified and measured the DBH of the five nearest trees that were counted as "in" using the wedge prism.

```{r trees}

forest_data$age[forest_data$age=="M"] <- "Mature forest"
forest_data$age[forest_data$age=="Y"] <- "Young forest"
# levels(forest_data$age) <- c("Mature","Young")

#  Basal area calculation: "trees_in"*10 = basal area (ft^2 acre^-1)
#  Conversion to m^2 ha^-1: 1 acre = .404686 hectares; 1 ft^2 = .0929 m^2
forest_data <- forest_data %>%
  mutate(basal_area_m2_ha = trees_in*10*(.0929/.404686))

## DBH plot
# ggplot(forest_data, aes(distance, dbh_cm, shape = age, color = age)) +
#   scale_shape_manual(values = c(16,15)) +
#   stat_summary(fun.data = "mean_se", geom = "pointrange", size = .7) +
#   color_manual +
#   theme_classic() +
#   theme(legend.title = element_blank()) +
#   xlab("Distance from road (m)") +
#   ylab("DBH (cm)")

## Basal area plot
ggplot(forest_data, aes(distance, basal_area_m2_ha, shape = age, color = age)) +
  scale_shape_manual(values = c(16,15)) +
  stat_summary(fun.data = "mean_se", geom = "pointrange", size = .7) +
  color_manual +
  theme_classic() +
  theme(legend.title = element_blank()) +
  xlab("Distance from road (m)") +
  ylab(expression(paste("Basal area (", {m}^2, "  ", {ha}^-1, ")")))

## Summarise mean and SE into new dataframe
avg_forest_data <- forest_data %>%
  group_by(age, habitat_type) %>% 
  summarise(
    richness = n_distinct(species),
    avg_dbh = mean(dbh_cm, na.rm = T),
    se_dbh = sd(dbh_cm, na.rm = T)/sqrt(length(dbh_cm)),
    total_dbh = sum(dbh_cm, na.rm = T),
    avg_basal_area = mean(basal_area_m2_ha, na.rm = T),
    se_basal_area = sd(basal_area_m2_ha, na.rm = T)/sqrt(length(basal_area_m2_ha))
  )

# ggplot(avg_forest_data, aes(age, avg_dbh, fill = habitat_type)) +
#   geom_col(position = "dodge") +
#   geom_errorbar(aes(ymin = avg_dbh - se_dbh, ymax = avg_dbh + se_dbh), width = 0, position = position_dodge(width = .9)) +
#   fill_manual +
#   theme_classic() +
#   theme(legend.title = element_blank()) +
#   xlab("") +
#   ylab("DBH (cm)")

ggplot(avg_forest_data, aes(age, avg_basal_area, fill = habitat_type)) +
  geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = avg_basal_area - se_basal_area, ymax = avg_basal_area + se_basal_area), width = 0, position = position_dodge(width = .9)) +
  fill_manual +
  theme_classic() +
  theme(legend.title = element_blank()) +
  xlab("") +
  ylab(expression(paste("Basal area (", {m}^2, "  ", {ha}^-1, ")")))

```

Basal area essentially defines young (<40 years) vs. mature forest (>60 years), although the difference is much smaller at the edges (i.e. 0 m).

```{r tree models, eval=F}
skimr::skim(forest_data)
# library(lme4)
# library(lmerTest)

# dbh_lm <- lmer(basal_area ~ distance*age, data = forest_data)
# plot(dbh_lm)
# summary(dbh_lm)
# dbh_lm2 <- glm(dbh_cm ~ habitat_type*age, data = forest_data)
# summary(dbh_lm2)

basal_area_lm <- glm(basal_area_m2_ha ~ distance*age, data = forest_data)
plot(basal_area_lm)
summary(basal_area_lm)

basal_area_lm2 <- glm(basal_area_m2_ha ~ habitat_type*age, data = forest_data)
plot(basal_area_lm2)
summary(basal_area_lm2)

```

## Light availability
In the summer of 2005, photosynthetically active radiation (PAR) was measured as photosynthetic photon flux density (PPFD) at five locations at each distance at each site along a 5 m long transect parallel to the road. From these measurements, we calculated the percent available light at each location as the ratio of the PAR value to the PAR value measured in open sun.

```{r light}

light_data$age[light_data$age=="M"] <- "Mature forest"
light_data$age[light_data$age=="Y"] <- "Young forest"

# skimr::skim(light_data)

ggplot(light_data, aes(distance, (pct_light), shape = age, color = age)) +
  scale_shape_manual(values = c(16,15)) +
  stat_summary(fun.data = "mean_se", geom = "pointrange", size = .7) +
  geom_smooth(method = "lm", alpha = .2, se = F) +
  color_manual +
  theme_classic() +
  theme(legend.title = element_blank()) +
  xlab("Distance from road (m)") +
  ylab("Light (%)")

# qplot(habitat_type, pct_light, data = light_data, geom = "boxplot")

avg_light_data <- light_data %>% 
  group_by(age, habitat_type) %>% 
  summarise(avg_pct_light = mean(pct_light),
            se_pct_light = sd(pct_light)/length(pct_light))

ggplot(avg_light_data, aes(habitat_type, avg_pct_light, fill = age)) +
  geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = avg_pct_light - se_pct_light, ymax = avg_pct_light + se_pct_light), width = 0, position = position_dodge(width = .9)) +
  fill_manual +
  # scale_fill_manual(values = c("grey90","grey50")) +
  theme_classic() +
  theme(legend.title = element_blank()) +
  xlab("") +
  ylab("Light (%)") +
  ggtitle("Edge: 0-10 m, Interior: 20-60 m")

```

Light availability decreases with distance to road with no overall difference between forest age, however, there is substantial variation within and between forest age depending on the specific distance. Averaged across forest age, light availability was greater at the forest edge (0 m) compared to other distances. At mature forest sites, light availability was greatest at the forest edge (0 m), but at young forest sites it was greatest at 20 m from the edge.

```{r light models, eval=F}

light_lm <- glm(log10(pct_light) ~ factor(distance)*age, data = light_data)
plot(light_lm)
summary(light_lm)

# summary(MASS::glm.nb(pct_light ~ distance, data = light_data))

light_lm2 <- glm((pct_light) ~ habitat_type, data = light_data)
plot(light_lm2)
summary(light_lm2)

car::Anova(light_lm)

t.test(log10(pct_light) ~ distance, data = filter(light_data, distance==0|distance==40))

```

## Soil moisture
In the summer of 2005, we also collected 125 cm^3^ mineral soil samples at the center of each 5 m transect to measure gravimetric water content.

```{r soil}

soil_moisture_data$age[soil_moisture_data$age=="M"] <- "Mature forest"
soil_moisture_data$age[soil_moisture_data$age=="Y"] <- "Young forest"

ggplot(soil_moisture_data, aes(distance, pct_moisture, shape = age, color = age)) +
  scale_shape_manual(values = c(16,15)) +
  stat_summary(fun.data = "mean_se", geom = "pointrange", size = .7) +
  geom_smooth(method = "lm", se = F, show.legend = F) +
  color_manual +
  theme_classic() +
  theme(legend.title = element_blank()) +
  xlab("Distance from road (m)") +
  ylab("Soil moisture (%)")


# ggplot(soil_moisture_data, aes(age, pct_moisture, fill = habitat_type)) +
#   geom_boxplot(notch = F) +
#   # geom_violin() +
#   scale_fill_manual(values = c("black", "grey90")) +
#   theme_classic()

## Pooled soil moisture data
# ggplot(soil_moisture_data, aes(distance, pct_moisture)) +
#   # scale_shape_manual(values = c(16,15)) +
#   stat_summary(fun.data = "mean_se", geom = "pointrange", size = .7) +
#   # scale_color_manual(values = c("black", "grey65")) +
#   theme_classic()


avg_soil_data <- soil_moisture_data %>% 
  group_by(age, habitat_type) %>% 
  summarise(avg_pct_moisture = mean(pct_moisture),
            se_pct_moisture = sd(pct_moisture)/length(pct_moisture))

ggplot(avg_soil_data, aes(age, avg_pct_moisture, fill = habitat_type)) +
  geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = avg_pct_moisture - se_pct_moisture, ymax = avg_pct_moisture + se_pct_moisture), width = 0, position = position_dodge(width = .9)) +
  fill_manual +
  theme_classic() +
  theme(legend.title = element_blank()) +
  xlab("") +
  ylab("Soil moisture (%)")

# soil_lm <- lm(pct_moisture ~ (distance), data = soil_moisture_data)
# summary(soil_lm)
# car::Anova(soil_lm, type = 3)
## Slope of the overall average line is

# soil_lm2 <- lm(pct_moisture ~ factor(distance), data = soil_moisture_data)
# summary(soil_lm2)
## No overall statistical differences between 0 meter and other distances

```

Overall, soil moisture incarease further from the edge (p = .055), with a stronger relationship at young forest sites than mature forest sites (not significant except at 60 m). Still, the effective difference in the average soil moisture is only a couple percentage points.

## Litter
We collected leaf litter from within a 25 cm x 25 cm PVC frame at each of the six distances from roads at each site in December 2008

```{r litter}

litter_data$age[litter_data$age=="M"] <- "Mature forest"
litter_data$age[litter_data$age=="Y"] <- "Young forest"


# .25*.25 = .0625 m^2
# 1 g = .001 kg
litter_data <- litter_data %>% 
  mutate(litter_kg_m2 = litter*(.001/.0625))

ggplot(litter_data, aes(distance, litter_kg_m2, shape = age, color = age)) +
  scale_shape_manual(values = c(16,15)) +
  stat_summary(fun.data = "mean_se", geom = "pointrange", size = .7) +
  geom_smooth(method = "lm", se = F, show.legend = F) +
  color_manual +
  theme_classic() +
  theme(legend.title = element_blank()) +
  xlab("Distance from road (m)") +
  ylab(expression(paste("Litter (kg ", {m}^-2, ")")))


avg_litter_data <- litter_data %>% 
  group_by(age, habitat_type) %>% 
  summarise(avg_litter = mean(litter_kg_m2),
            se_litter = sd(litter_kg_m2)/length(litter_kg_m2))

ggplot(avg_litter_data, aes(age, avg_litter, fill = habitat_type)) +
  geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = avg_litter - se_litter, ymax = avg_litter + se_litter), width = 0, position = position_dodge(width = .9)) +
  scale_fill_manual(values = c("grey90", "grey50")) +
  theme_classic() +
  theme(legend.title = element_blank()) +
  xlab("") +
  ylab(expression(paste("Litter (kg ", {m}^-2, ")")))

# litter_lm <- lm(litter_kg_m2 ~ distance*age, data = litter_data)
# summary(litter_lm)
# litter_lm2 <- lm(litter_kg_m2 ~ habitat_type*age, data = litter_data)
# summary(litter_lm2)
# 
# AIC(litter_lm)
# AIC(litter_lm2)

```



*** 

# Species data

For all of these, the solid-fill symbols are the non-native species.

## Experiment 1: Seed germination

```{r germination}

# names(germination_data)
germination_data$age[germination_data$age=="Y"] <- "Young forest"
germination_data$age[germination_data$age=="M"] <- "Mature forest"

germination_data$common_name <- factor(
  germination_data$common_name, levels = c("Autumn olive","Honeysuckle","Privet","Dogwood","Redbud","Spicebush"))
germination_data$status <- factor(germination_data$status, levels = c("Native","Non-native"))

avg_germination_data <- germination_data %>% 
  group_by(status, distance, common_name, age) %>% 
  summarise(avg_germinated = mean(pct_germinated, na.rm = T))


ggplot(germination_data, aes(distance, pct_germinated)) +
  stat_summary(aes(shape = common_name), fun.data = "mean_se", geom = "point", size = 2.5) +
  geom_smooth(aes(linetype = status), method = "lm", se = F, show.legend = F, color = "grey50") +
  # scale_shape_manual(values = c(rep(16, 3), rep(17, 3))) +
  # scale_color_manual(values = c(brewer.pal(3, "RdBu"), brewer.pal(3, "RdBu"))) +
  scale_linetype_manual(values = c(2,1)) +
  # scale_color_brewer(palette = "RdBu") +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Percent germination") +
  xlab("Distance from road (m)")

# ggsave("figures/pct_germinated.png", dpi = 600, width = 7, height = 3.5)

ggplot(avg_germination_data, aes(distance, avg_germinated)) +
  geom_point(aes(shape = common_name), show.legend = F) +
  geom_line(aes(linetype = common_name)) +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Percent germination") +
  xlab("Distance from road (m)")

```


## Experiment 2: Seedling growth and survival

```{r seedling data manipulation}

# names(seedling_data)
seedling_data$common_name <- "NA"
seedling_data$common_name[seedling_data$species=="D"] <- "Dogwood"
seedling_data$common_name[seedling_data$species=="A"] <- "Autumn olive"
seedling_data$common_name[seedling_data$species=="H"] <- "Honeysuckle"
seedling_data$common_name[seedling_data$species=="P"] <- "Privet"
seedling_data$common_name[seedling_data$species=="R"] <- "Redbud"
seedling_data$common_name[seedling_data$species=="S"] <- "Spicebush"

seedling_data$common_name <- factor(
  seedling_data$common_name, levels = c("Autumn olive","Honeysuckle","Privet","Dogwood","Redbud","Spicebush"))

seedling_data$status[seedling_data$status=="n"] <- "Native"
seedling_data$status[seedling_data$status=="e"] <- "Non-native"

seedling_data$status <- factor(seedling_data$status, levels = c("Native","Non-native"))

seedling_data$age[seedling_data$age=="young"] <- "Young forest"
seedling_data$age[seedling_data$age=="mature"] <- "Mature forest"

```

```{r seedling_height}

ggplot(seedling_data, aes(distance, final_ht06)) +
  stat_summary(aes(shape = common_name), fun.data = "mean_se", geom = "point", size = 2.5) +
  geom_smooth(aes(linetype = status), method = "lm", se = F, show.legend = F, color = "grey50") +
  scale_linetype_manual(values = c(2,1)) +
  scale_color_brewer(palette = "RdBu") +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Height (cm)") +
  xlab("Distance from road (m)")

```

```{r seedling_diameter}

ggplot(seedling_data, aes(distance, diameter06)) +
  stat_summary(aes(shape = common_name), fun.data = "mean_se", geom = "point", size = 2.5) +
  geom_smooth(aes(linetype = status), method = "lm", se = F, show.legend = F, color = "grey50") +
  scale_linetype_manual(values = c(2,1)) +
  scale_color_brewer(palette = "RdBu") +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Diameter (mm)") +
  xlab("Distance from road (m)")

```

```{r seedling_biomass}

ggplot(seedling_data, aes(distance, tot_biomass)) +
  stat_summary(aes(shape = common_name), fun.data = "mean_se", geom = "pointrange" ) +
  geom_smooth(aes(linetype = status), method = "lm", se = F, show.legend = F, color = "grey50") +
  scale_linetype_manual(values = c(2,1)) +
  scale_color_brewer(palette = "RdBu") +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Biomass (g)") +
  xlab("Distance from road (m)")

biomass_data <- seedling_data %>% 
  group_by(distance, status, age, common_name) %>% 
  summarise(avg_biomass = mean(tot_biomass, na.rm = T),
            avg_leaf_biomass = mean(leaf_biomass, na.rm = T),
            avg_stem_biomass = mean(stem_biomass, na.rm = T),
            avg_stem_leaf_ratio = mean(stem_biomass/leaf_biomass, na.rm = T))

ggplot(biomass_data, aes(distance, avg_biomass)) +
  geom_point(aes(shape = common_name)) +
  geom_line(aes(linetype = common_name)) +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Biomass (g)") +
  xlab("Distance from road (m)")

```



```{r rel_growth}

ggplot(seedling_data, aes(distance, rgr_ht_days)) +
  stat_summary(aes(shape = common_name), fun.data = "mean_se", geom = "point", size = 2.5) +
  geom_smooth(aes(linetype = status), method = "lm", se = F, show.legend = F, color = "grey50") +
  scale_linetype_manual(values = c(2,1)) +
  scale_color_brewer(palette = "RdBu") +
  facet_wrap(~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Relative growth rate (% / day)") +
  xlab("Distance from road (m)") 

```


```{r herbivory, fig.height=8}

# names(seedling_data)

herbiv <- select(seedling_data, site_name:status, common_name, starts_with("herb"))
herbiv <- herbiv %>% 
  gather(year, herbivory, herbivory04:herbivory06)
herbiv$year[herbiv$year=="herbivory04"] <- 2004
herbiv$year[herbiv$year=="herbivory05"] <- 2005
herbiv$year[herbiv$year=="herbivory06"] <- 2006

ggplot(filter(herbiv, year == 2006), aes(distance, herbivory)) +
  stat_summary(aes(shape = common_name), fun.data = "mean_se", geom = "point", size = 2.5) +
  geom_smooth(aes(linetype = status), method = "lm", se = F, show.legend = F, color = "grey50") +
  scale_linetype_manual(values = c(2,1)) +
  scale_color_brewer(palette = "RdBu") +
  facet_grid(.~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Herbivory") +
  xlab("Distance from road (m)") 

```

Increased with distance from edge for both native and non-native species in young forests, but decreased with distance from edge for native species in mature forests. There was relationship between distance from edge and herbivory for non-native species in mature forests. Herbivory was greater on native than non-native species in both forest types.

Herbivory was categorized, where 1 = 1-25%, 2 = 26-50%, 3 = 51-75%.

What kind of herbivory might this be? Deer? Defoliators?


```{r survival}

surv <- select(seedling_data, site_name:status, common_name, starts_with("surv"))
surv <- surv %>% gather(year, survival, survival04:survival06)
surv$year[surv$year=="survival04"] <- 2004
surv$year[surv$year=="survival05"] <- 2005
surv$year[surv$year=="survival06"] <- 2006

surv <- surv %>% 
  group_by(year, distance, age, status, common_name) %>% 
  filter(!is.na(survival)) %>% 
  summarise(pct_survival = 100*sum(survival)/length(survival))

ggplot(filter(surv, year == 2006), aes(distance, pct_survival)) +
  # geom_smooth(aes(linetype = common_name), method = "lm", se = F, show.legend = T, color = "grey50", size = .5) +
  geom_point(aes(shape = common_name), size = 2, show.legend = F) +
  geom_line(aes(linetype = common_name)) +
  # stat_summary(aes(shape = common_name), fun.data = "mean_se", geom = "point", size = 2.5, show.legend = F) +
  # scale_linetype_manual(values = c(2,1)) +
  # scale_color_brewer(palette = "RdBu") +
  facet_grid(.~age) +
  theme_bw() +
  theme(strip.background = element_blank(),
        panel.grid = element_blank(),
        legend.title = element_blank()) +
  ylab("Survival (%)") +
  xlab("Distance from road (m)") +
  ggtitle("Average seedling survival to 2006")


filter(surv, year == 2006) %>% 
  group_by(status, age) %>% 
  summarise(avg_pct_survival = mean(pct_survival))
```

Seedling survival over the duration of the experiment was high across sites and species (`r mean(surv$pct_survival)`). Autumn olive and dogwood had relatively low survival compared to the other species (AO: 49% mature, 50.7% young; DW: 60.4% mature, 41.7% young). Seedling survival for all other species averaged greater than 80%. In mature forests, autumn olive and dogwood both had lower survival with increasing distance from the edge, but in young forest autumn olive tended to have greater survival farther from the edge. 

While these general linear trends with distance are present, the precise relationship with distance from edge is non-linear across all species. In mature forests, most species showed greatest survival at 5 and 10 m from the edge, with the exception of honeysuckle, which had greatest survival at distances of 20 m and greater. Honeysuckle also had the greatest proportion of overall surviving seedlings (94.8%). In contrast, seedling survival in young forests was overall lower for native than non-native species, and also lower at interior versus edge locations for native species, except for spicebush. 


# Models
```{r models}
library(lme4)
# names(grouped_seedling_data)
# summary(grouped_seedling_data)
# grouped_seedling_data
# skimr::skim(grouped_seedling_data)

biomass_m1 <- lmer(log(avg_biomass) ~ (1|site_code) + (1|status/species) + (1|distance), data = grouped_seedling_data)
plot(biomass_m1)
summary(biomass_m1)

biomass_m2 <- lmer(log(avg_biomass) ~ distance + (1|site_code) + (1|species), data = grouped_seedling_data)
plot(biomass_m2)
summary(biomass_m2)


biomass_m3 <- lmer(log(avg_biomass) ~ distance + (1|site_code) + (1 + distance|status) + (1|site_code:species), data = grouped_seedling_data)
plot(biomass_m3)
summary(biomass_m3)

biomass_m4 <- lmer(log(avg_biomass) ~ distance + status + status:distance + + avg_basal_area + avg_pct_light + (1|site_code) + (1 + distance|species) + (1|site_code:species), data = grouped_seedling_data)
plot(biomass_m4)
summary(biomass_m4)

```


